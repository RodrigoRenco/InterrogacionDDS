namespace Classifier.Tests;

public class ControllerLogisticRegressionTests
{
    [Theory]
    [InlineData("one-hot", "car", 0.6994220, 0.01, 0)]
    [InlineData("one-hot", "car", 0.6994220, 0.1, 0)]
    [InlineData("one-hot", "car", 0.6994220, 1, 0)]
    [InlineData("label", "car", 0.6994220, 0.01, 0)]
    [InlineData("label", "car", 0.6994220, 0.1, 0)]
    [InlineData("label", "car", 0.6994220, 1, 0)]
    [InlineData("one-hot", "car", 0.6994220, 0, 0)]
    [InlineData("one-hot", "car", 0.6994220, 0, 1)]
    [InlineData("one-hot", "car", 0.6994220, 0, 10)]
    [InlineData("one-hot", "car", 0.6994220, 0, 100)]
    [InlineData("label", "car", 0.6994220, 0, 0)]
    [InlineData("label", "car", 0.6994220, 0, 1)]
    [InlineData("label", "car", 0.6994220, 0, 10)]
    [InlineData("label", "car", 0.6994220, 0, 100)]
    [InlineData("one-hot", "separable", 1, 0.01, 10)]
    [InlineData("label", "separable", 1, 0.01, 10)]
    [InlineData("one-hot", "separable", 1, 0.01, 100)]
    [InlineData("label", "separable", 1, 0.01, 100)]
    [InlineData("one-hot", "non-separable", 0.5, 0.01, 50)]
    [InlineData("one-hot", "non-separable", 0.5, 0.01, 200)]
    [InlineData("one-hot", "non-separable", 0.5, 0.1, 50)]
    [InlineData("one-hot", "non-separable", 0.5, 0.1, 200)]
    [InlineData("label", "non-separable", 0.5, 0.01, 50)]
    [InlineData("label", "non-separable", 0.5, 0.01, 200)]
    [InlineData("label", "non-separable", 0.5, 0.1, 50)]
    [InlineData("label", "non-separable", 0.5, 0.1, 200)]
    [InlineData("one-hot", "imbalanced", 0.6666666, 0.01,10)]
    [InlineData("label", "imbalanced", 1, 0.01,10)]
    [InlineData("one-hot", "single-class", 0, 0.01, 1)]
    [InlineData("one-hot", "single-class", 0, 0.01, 10)]
    [InlineData("one-hot", "single-class", 0, 0.01, 100)]
    [InlineData("one-hot", "single-class", 0, 0.1, 1)]
    [InlineData("one-hot", "single-class", 0, 0.1, 10)]
    [InlineData("one-hot", "single-class", 0, 0.1, 100)]
    [InlineData("one-hot", "single-class", 0, 1, 1)]
    [InlineData("one-hot", "single-class", 0, 1, 10)]
    [InlineData("one-hot", "single-class", 0, 1, 100)]
    [InlineData("label", "single-class", 0, 0.01, 1)]
    [InlineData("label", "single-class", 0, 0.01, 10)]
    [InlineData("label", "single-class", 0, 0.01, 100)]
    [InlineData("label", "single-class", 0, 0.1, 1)]
    [InlineData("label", "single-class", 0, 0.1, 10)]
    [InlineData("label", "single-class", 0, 0.1, 100)]
    [InlineData("label", "single-class", 0, 1, 1)]
    [InlineData("label", "single-class", 0, 1, 10)]
    [InlineData("label", "single-class", 0, 1, 100)]
    [InlineData("one-hot","unseen-feature", 1, 0.01,50)]
    [InlineData("label","unseen-feature", 0, 0.01,50)]
    [InlineData("one-hot", "multiclass-separable", 1, 0.01, 50)]
    [InlineData("label", "multiclass-separable", 1, 0.01, 50)]
    [InlineData("one-hot", "unseen-class", 0 , 0.1, 1)]
    [InlineData("one-hot", "unseen-class", 0 , 0.1, 10)]
    [InlineData("one-hot", "unseen-class", 0 , 0.1, 100)]
    [InlineData("one-hot", "unseen-class", 0 , 0.01, 1)]
    [InlineData("one-hot", "unseen-class", 0 , 0.01, 10)]
    [InlineData("one-hot", "unseen-class", 0 , 0.01, 100)]
    [InlineData("one-hot", "unseen-class", 0 , 1, 1)]
    [InlineData("one-hot", "unseen-class", 0 , 1, 10)]
    [InlineData("one-hot", "unseen-class", 0 , 1, 100)]
    [InlineData("label", "unseen-class", 0 , 0.1, 1)]
    [InlineData("label", "unseen-class", 0 , 0.1, 10)]
    [InlineData("label", "unseen-class", 0 , 0.1, 100)]
    [InlineData("label", "unseen-class", 0 , 0.01, 1)]
    [InlineData("label", "unseen-class", 0 , 0.01, 10)]
    [InlineData("label", "unseen-class", 0 , 0.01, 100)]
    [InlineData("label", "unseen-class", 0 , 1, 1)]
    [InlineData("label", "unseen-class", 0 , 1, 10)]
    [InlineData("label", "unseen-class", 0 , 1, 100)]
    [InlineData("label", "mushrooms", 0.5178352, 0.0000001, 1)]
    [InlineData("label", "mushrooms", 0.8708487, 0.0000001, 10)]
    [InlineData("label", "mushrooms", 0.9102091, 0.0000001, 100)]
    [InlineData("one-hot", "mushrooms", 0.8868389, 0.0000001, 1)]
    [InlineData("one-hot", "mushrooms", 0.8868389, 0.0000001, 10)]
    [InlineData("one-hot", "mushrooms", 0.8868389, 0.0000001, 100)]
    [InlineData("label", "mushrooms", 0.8733087, 0.000001, 1)]
    [InlineData("label", "mushrooms", 0.9102091, 0.000001, 10)]
    [InlineData("label", "mushrooms", 0.9458795, 0.000001, 100)]
    [InlineData("one-hot", "mushrooms", 0.8868389, 0.000001, 1)]
    [InlineData("one-hot", "mushrooms", 0.8868389, 0.000001, 10)]
    [InlineData("one-hot", "mushrooms", 0.8856089, 0.000001, 100)]
    public void Handle_ReturnCorrectAccuracyForLogisticRegression(string encoderType, string dataset, double accuracy,
        double learningRate, int epochs)
    {
        ClassificationRequest request = new ClassificationRequest(encoderType, "logistic-regression", "accuracy",
            dataset, learningRate: learningRate, epochs: epochs);
        AssertSuccessfulResult(request, accuracy);
    }

    [Theory]
    [InlineData("one-hot", "car", 0.25, 0.01, 0)]
    [InlineData("one-hot", "car", 0.25, 0.1, 0)]
    [InlineData("one-hot", "car", 0.25, 1, 0)]
    [InlineData("label", "car", 0.25, 0.01, 0)]
    [InlineData("label", "car", 0.25, 0.1, 0)]
    [InlineData("label", "car", 0.25, 1, 0)]
    [InlineData("one-hot", "car", 0.25, 0, 0)]
    [InlineData("one-hot", "car", 0.25, 0, 1)]
    [InlineData("one-hot", "car", 0.25, 0, 10)]
    [InlineData("one-hot", "car", 0.25, 0, 100)]
    [InlineData("label", "car", 0.25, 0, 0)]
    [InlineData("label", "car", 0.25, 0, 1)]
    [InlineData("label", "car", 0.25, 0, 10)]
    [InlineData("label", "car", 0.25, 0, 100)]
    [InlineData("one-hot", "separable", 1, 0.01, 10)]
    [InlineData("label", "separable", 1, 0.01, 10)]
    [InlineData("one-hot", "separable", 1, 0.01, 100)]
    [InlineData("label", "separable", 1, 0.01, 100)]
    [InlineData("one-hot", "non-separable", 0.5, 0.01, 50)]
    [InlineData("one-hot", "non-separable", 0.5, 0.01, 200)]
    [InlineData("one-hot", "non-separable", 0.5, 0.1, 50)]
    [InlineData("one-hot", "non-separable", 0.5, 0.1, 200)]
    [InlineData("label", "non-separable", 0.5, 0.01, 50)]
    [InlineData("label", "non-separable", 0.5, 0.01, 200)]
    [InlineData("label", "non-separable", 0.5, 0.1, 50)]
    [InlineData("label", "non-separable", 0.5, 0.1, 200)]
    [InlineData("one-hot", "imbalanced", 0.5, 0.01,10)]
    [InlineData("label", "imbalanced", 1, 0.01,10)]
    [InlineData("one-hot", "single-class", 0, 0.01, 1)]
    [InlineData("one-hot", "single-class", 0, 0.01, 10)]
    [InlineData("one-hot", "single-class", 0, 0.01, 100)]
    [InlineData("one-hot", "single-class", 0, 0.1, 1)]
    [InlineData("one-hot", "single-class", 0, 0.1, 10)]
    [InlineData("one-hot", "single-class", 0, 0.1, 100)]
    [InlineData("one-hot", "single-class", 0, 1, 1)]
    [InlineData("one-hot", "single-class", 0, 1, 10)]
    [InlineData("one-hot", "single-class", 0, 1, 100)]
    [InlineData("label", "single-class", 0, 0.01, 1)]
    [InlineData("label", "single-class", 0, 0.01, 10)]
    [InlineData("label", "single-class", 0, 0.01, 100)]
    [InlineData("label", "single-class", 0, 0.1, 1)]
    [InlineData("label", "single-class", 0, 0.1, 10)]
    [InlineData("label", "single-class", 0, 0.1, 100)]
    [InlineData("label", "single-class", 0, 1, 1)]
    [InlineData("label", "single-class", 0, 1, 10)]
    [InlineData("label", "single-class", 0, 1, 100)]
    [InlineData("one-hot","unseen-feature", 1, 0.01,50)]
    [InlineData("label","unseen-feature", 0, 0.01,50)]
    [InlineData("one-hot", "multiclass-separable", 1, 0.01, 50)]
    [InlineData("label", "multiclass-separable", 1, 0.01, 50)]
    [InlineData("one-hot", "unseen-class", 0 , 0.1, 1)]
    [InlineData("one-hot", "unseen-class", 0 , 0.1, 10)]
    [InlineData("one-hot", "unseen-class", 0 , 0.1, 100)]
    [InlineData("one-hot", "unseen-class", 0 , 0.01, 1)]
    [InlineData("one-hot", "unseen-class", 0 , 0.01, 10)]
    [InlineData("one-hot", "unseen-class", 0 , 0.01, 100)]
    [InlineData("one-hot", "unseen-class", 0 , 1, 1)]
    [InlineData("one-hot", "unseen-class", 0 , 1, 10)]
    [InlineData("one-hot", "unseen-class", 0 , 1, 100)]
    [InlineData("label", "unseen-class", 0 , 0.1, 1)]
    [InlineData("label", "unseen-class", 0 , 0.1, 10)]
    [InlineData("label", "unseen-class", 0 , 0.1, 100)]
    [InlineData("label", "unseen-class", 0 , 0.01, 1)]
    [InlineData("label", "unseen-class", 0 , 0.01, 10)]
    [InlineData("label", "unseen-class", 0 , 0.01, 100)]
    [InlineData("label", "unseen-class", 0 , 1, 1)]
    [InlineData("label", "unseen-class", 0 , 1, 10)]
    [InlineData("label", "unseen-class", 0 , 1, 100)]
    [InlineData("label", "mushrooms", 0.5, 0.0000001, 1)]
    [InlineData("label", "mushrooms", 0.8665986, 0.0000001, 10)]
    [InlineData("label", "mushrooms", 0.9089086, 0.0000001, 100)]
    [InlineData("one-hot", "mushrooms", 0.8831802, 0.0000001, 1)]
    [InlineData("one-hot", "mushrooms", 0.8831802, 0.0000001, 10)]
    [InlineData("one-hot", "mushrooms", 0.8831802, 0.0000001, 100)]
    [InlineData("label", "mushrooms", 0.8691496, 0.000001, 1)]
    [InlineData("label", "mushrooms", 0.9088207, 0.000001, 10)]
    [InlineData("label", "mushrooms", 0.9452833, 0.000001, 100)]
    [InlineData("one-hot", "mushrooms", 0.8831802, 0.000001, 1)]
    [InlineData("one-hot", "mushrooms", 0.8831802, 0.000001, 10)]
    [InlineData("one-hot", "mushrooms", 0.8820804, 0.000001, 100)]
    public void Handle_ReturnCorrectRecallForLogisticRegression(string encoderType, string dataset, double recall,
        double learningRate, int epochs)
    {
        ClassificationRequest request = new ClassificationRequest(encoderType, "logistic-regression", "recall", dataset,
            learningRate: learningRate, epochs: epochs);
        AssertSuccessfulResult(request, recall);
    }
    
    private void AssertSuccessfulResult(ClassificationRequest request, double expected)
    {
        Controller controller = new();
        var result = controller.Handle(request);
        Assert.Null(result.ErrorMessage);
        Assert.Equal(expected, (double)result.Score!, 0.0000001);
    }
}